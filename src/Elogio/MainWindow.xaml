<ui:FluentWindow x:Class="Elogio.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:viewModels="clr-namespace:Elogio.ViewModels"
                 xmlns:views="clr-namespace:Elogio.Views.Pages"
                 mc:Ignorable="d"
                 Title="{Binding Title}"
                 Height="700" Width="1100"
                 MinHeight="500" MinWidth="800"
                 WindowStartupLocation="CenterScreen"
                 ExtendsContentIntoTitleBar="True"
                 WindowBackdropType="Mica" d:DataContext="{d:DesignInstance viewModels:MainViewModel}">

    <ui:FluentWindow.Resources>
        <!-- Navigation button style with icon and text -->
        <Style x:Key="NavButtonStyle" TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
            <Setter Property="Height" Value="40" />
            <Setter Property="Margin" Value="8,2" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Appearance" Value="Transparent" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
        </Style>
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     ShowMaximize="True"
                     ShowMinimize="True">
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Label Content="{Binding Title}" Margin="16,0,0,0" VerticalAlignment="Center"></Label>

                    <!-- Update Status Box -->
                    <Border CornerRadius="4"
                            Padding="8,2"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Background="{Binding UpdateStatusBrush}"
                            Visibility="{Binding IsUpdateStatusVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="{Binding UpdateStatusIcon}"
                                           FontSize="14"
                                           Foreground="White"
                                           VerticalAlignment="Center" />
                            <TextBlock Text="{Binding UpdateStatusText}"
                                       Foreground="White"
                                       FontSize="12"
                                       VerticalAlignment="Center"
                                       Margin="6,0,0,0" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ui:TitleBar.Header>
        </ui:TitleBar>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <!-- Update Available Banner -->
            <Border Visibility="{Binding IsUpdateBannerVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                    Background="{ui:ThemeResource SystemFillColorNeutralBackgroundBrush}"
                    VerticalAlignment="Top"
                    Panel.ZIndex="100"
                    Padding="16,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon Grid.Column="0"
                                   Symbol="ArrowDownload24"
                                   FontSize="20"
                                   Margin="0,0,12,0"
                                   VerticalAlignment="Center" />

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding UpdateBannerVersionText}"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding UpdateBannerDetailsText}"
                                   FontSize="12"
                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>

                    <ui:Button Grid.Column="2"
                               Content="Install Now"
                               Appearance="Primary"
                               Margin="8,0"
                               IsEnabled="{Binding IsInstallUpdateEnabled}"
                               Command="{Binding InstallUpdateCommand}" />

                    <ui:Button Grid.Column="3"
                               Content="Later"
                               Appearance="Secondary"
                               Command="{Binding DismissUpdateBannerCommand}" />
                </Grid>
            </Border>

            <!-- Main layout with icon sidebar (hidden during login) -->
            <Grid x:Name="MainLayout"
                  Visibility="{Binding IsMainLayoutVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  Margin="{Binding IsUpdateBannerVisible, Converter={StaticResource BoolToMarginConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Sidebar with icons and text -->
                <Border Grid.Column="0"
                        Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                        BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="0,0,1,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Employee info -->
                        <Border Grid.Row="0" Margin="8,16,8,8">
                            <StackPanel Orientation="Horizontal" Margin="8,0">
                                <ui:SymbolIcon Symbol="Person24" FontSize="20" VerticalAlignment="Center" />
                                <TextBlock Text="{Binding EmployeeName}"
                                           VerticalAlignment="Center"
                                           Margin="12,0,0,0"
                                           FontWeight="SemiBold"
                                           TextTrimming="CharacterEllipsis" />
                            </StackPanel>
                        </Border>

                        <!-- Navigation -->
                        <StackPanel Grid.Row="1" Margin="0,8,0,0">
                            <!-- Dashboard -->
                            <ui:Button Command="{Binding NavigateToDashboardCommand}">
                                <ui:Button.Style>
                                    <Style TargetType="ui:Button" BasedOn="{StaticResource NavButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Value="True"
                                                         Binding="{Binding CurrentPageType, Converter={StaticResource PageTypeToIsActiveConverter}, ConverterParameter={x:Type views:DashboardPage}}">
                                                <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ui:Button.Style>
                                <ui:Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="Board24" FontSize="18" VerticalAlignment="Center" />
                                        <TextBlock Text="Dashboard" VerticalAlignment="Center" Margin="12,0,0,0" />
                                    </StackPanel>
                                </ui:Button.Content>
                            </ui:Button>

                            <!-- Monthly Calendar -->
                            <ui:Button Command="{Binding NavigateToCalendarCommand}">
                                <ui:Button.Style>
                                    <Style TargetType="ui:Button" BasedOn="{StaticResource NavButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Value="True"
                                                         Binding="{Binding CurrentPageType, Converter={StaticResource PageTypeToIsActiveConverter}, ConverterParameter={x:Type views:MonthlyCalendarPage}}">
                                                <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ui:Button.Style>
                                <ui:Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="CalendarLtr24" FontSize="18" VerticalAlignment="Center" />
                                        <TextBlock Text="Monatskalender" VerticalAlignment="Center" Margin="12,0,0,0" />
                                    </StackPanel>
                                </ui:Button.Content>
                            </ui:Button>

                            <!-- Yearly Calendar -->
                            <ui:Button Command="{Binding NavigateToYearlyCalendarCommand}">
                                <ui:Button.Style>
                                    <Style TargetType="ui:Button" BasedOn="{StaticResource NavButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Value="True"
                                                         Binding="{Binding CurrentPageType, Converter={StaticResource PageTypeToIsActiveConverter}, ConverterParameter={x:Type views:YearlyCalendarPage}}">
                                                <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ui:Button.Style>
                                <ui:Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="CalendarMultiple24" FontSize="18" VerticalAlignment="Center" />
                                        <TextBlock Text="Jahreskalender" VerticalAlignment="Center" Margin="12,0,0,0" />
                                    </StackPanel>
                                </ui:Button.Content>
                            </ui:Button>
                        </StackPanel>

                        <!-- Footer: Settings + Logout -->
                        <StackPanel Grid.Row="2" Margin="0,0,0,16">
                            <!-- Settings -->
                            <ui:Button Command="{Binding NavigateToSettingsCommand}">
                                <ui:Button.Style>
                                    <Style TargetType="ui:Button" BasedOn="{StaticResource NavButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Value="True"
                                                         Binding="{Binding CurrentPageType, Converter={StaticResource PageTypeToIsActiveConverter}, ConverterParameter={x:Type views:SettingsPage}}">
                                                <Setter Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ui:Button.Style>
                                <ui:Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="Settings24" FontSize="18" VerticalAlignment="Center" />
                                        <TextBlock Text="Einstellungen" VerticalAlignment="Center" Margin="12,0,0,0" />
                                    </StackPanel>
                                </ui:Button.Content>
                            </ui:Button>

                            <!-- Separator -->
                            <Border Height="1"
                                    Background="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                    Margin="12,8" />

                            <!-- Logout -->
                            <ui:Button Style="{StaticResource NavButtonStyle}"
                                       Command="{Binding LogoutCommand}">
                                <ui:Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="SignOut24" FontSize="18" VerticalAlignment="Center" />
                                        <TextBlock Text="Abmelden" VerticalAlignment="Center" Margin="12,0,0,0" />
                                    </StackPanel>
                                </ui:Button.Content>
                            </ui:Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content Frame -->
                <Frame Grid.Column="1"
                       x:Name="ContentFrame"
                       NavigationUIVisibility="Hidden" />
            </Grid>

            <!-- Login Frame (shown when not authenticated) -->
            <Frame x:Name="LoginFrame"
                   NavigationUIVisibility="Hidden"
                   Visibility="{Binding IsLoginVisible, Converter={StaticResource BoolToVisibilityConverter}}" />

            <!-- Loading Overlay (for auto-login) -->
            <Grid Visibility="{Binding IsLoadingVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  Background="{ui:ThemeResource ApplicationBackgroundBrush}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="ELOGIO"
                               FontSize="32"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                    <ui:ProgressRing IsIndeterminate="True"
                                     Width="40" Height="40"
                                     Margin="0,24,0,0" />
                    <TextBlock Text="{Binding LoadingStatusText}"
                               FontSize="14"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"
                               Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" />
                </StackPanel>
            </Grid>

            <!-- Snackbar for toast notifications -->
            <ui:SnackbarPresenter x:Name="SnackbarPresenter" />
        </Grid>
    </Grid>
</ui:FluentWindow>
